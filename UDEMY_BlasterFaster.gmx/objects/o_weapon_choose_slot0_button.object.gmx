<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>s_gun_00_box_alr3</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>-1000</depth>
  <persistent>0</persistent>
  <parentName>o_button_parent</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// initialise the button
image_speed = 0;

//create array of available guns
// Slot [0]
weapons_slot[0] = o_ship_00_dummyGun;
weapons_slot[1] = o_ship_01_Lgun;
weapons_slot[2] = o_ship_02_Lgun;
weapons_slot[3] = o_ship_03_Lgun;


// initialise the variable for toggling the guns
gun_choice = 0;

// check what is the value and set it
for (i = 0; i &lt;= array_length_1d(weapons_slot) - 1; i++)
{
    if instance_exists(global.ship.slot[0])
    {
        if object_get_name(global.ship.slot[0].object_index) == object_get_name(weapons_slot[i])
        {
                gun_choice =   i;
        } 
//        else 
//        {
//            gun_choice = 0;
//        }
    } else 
        gun_choice = 0;
}
show_debug_message("gun_choice = " + string(gun_choice));

// TESTING
// create the gun stats for the gun
gun_stats = instance_create(x - sprite_width/2, y-sprite_height/2, o_gun_stats);
gun_stats.owner = id;

if instance_exists(global.ship.slot[0])
{
    // do nothing really
}
else
{
    // if there is no weapon just add the default one
    add_weapon(o_ship_00_dummyGun, 0);
}

// Get the detailsfrom the gun for the Gun Stats display
gun_stats.damage = weapons_slot[gun_choice].damage;
gun_stats.ammo_capacity = weapons_slot[gun_choice].ammo_capacity;
gun_stats.recharge_time = weapons_slot[gun_choice].recharge_time;
gun_stats.fire_rate = weapons_slot[gun_choice].fire_rate;
gun_stats.energy_consumption = weapons_slot[gun_choice].energy_consumption;

// now set the price
for (i=0; i&lt;array_length_1d(global.current_player.purchased); i+=1)
{
    // for each weapon in the purchased list, set the price to 0
    if object_get_name(global.ship.slot[0].object_index) == global.current_player.purchased[i]
    {
        weapons_slot[gun_choice].price = 0;
    }
};
gun_stats.price = weapons_slot[gun_choice].price;


/*
current_gun = o_ship_new.slot[0];
old_mount_x = o_ship_new.slot[0].mount_x;
old_mount_y = o_ship_new.slot[0].mount_y;
*/
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Instantiate the purchase button
purchase_button = instance_create(0, 0, o_purchase_slot_button);
purchase_button.owner = id;
purchase_button.x = x + sprite_width/2;
purchase_button.y = y - purchase_button.sprite_height/2 - 2;
purchase_button.owner_slot = 0;
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Initialise the purchased label variable
purchased_label = noone;
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Check for purchase updates
if global.purchase_update[0] == true
{
    global.purchase_update[0] = false;
    
    // update the gun stats
    // now set the price
    for (i=0; i&lt;array_length_1d(global.current_player.purchased); i+=1)
    {
        // for each weapon in the purchased list, set the price to 0
        if object_get_name(global.ship.slot[0].object_index) == global.current_player.purchased[i]
        {
            weapons_slot[gun_choice].price = 0;
        }
    }
   
    show_debug_message("PRICE: " + string(weapons_slot[gun_choice].price));
    gun_stats.price = weapons_slot[gun_choice].price;
    
    if object_get_parent(global.ship.slot[0].object_index) != o_empty_slot
    {
    
        if instance_exists(purchased_label)
        {
            with (purchased_label)
            {
                instance_destroy();
            }
        }
        purchased_label = instance_create(x, y, o_gun_box_purchased);            
    }
    
    
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="6" enumb="4">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>///Inherit
event_inherited();
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>o_weapon_choose_slot0_button</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Toggle available weapons

if gun_choice &lt; array_length_1d(weapons_slot) - 1
{
    gun_choice += 1;
}
else
{
    gun_choice = 0;
}

// destroy if existing gun
if instance_exists(global.ship.slot[0])
{
    with(global.ship.slot[0])
    {
        instance_destroy();
    }
}

// now attach the weapon    
//add_weapon(o_ship_new, weapons_slot[gun_choice], 0);

// TESTING
//global.ship.slot[0] = instance_create(global.ship.ship_mount_x[0], global.ship.ship_mount_y[0], weapons_slot[gun_choice]);
//global.ship.slot[0].gun_slot_id = 0;

add_weapon(weapons_slot[gun_choice], 0);

// Read the data from the gun instance
gun_stats.damage = weapons_slot[gun_choice].damage;
gun_stats.ammo_capacity = weapons_slot[gun_choice].ammo_capacity;
gun_stats.recharge_time = weapons_slot[gun_choice].recharge_time;
gun_stats.fire_rate = weapons_slot[gun_choice].fire_rate;
// now set the price
for (i=0; i&lt;array_length_1d(global.current_player.purchased); i+=1)
{
    // for each weapon in the purchased list, set the price to 0
    if object_get_name(global.ship.slot[0].object_index) == global.current_player.purchased[i]
    {
        weapons_slot[gun_choice].price = 0;
    }
}

show_debug_message("PRICE: " + string(weapons_slot[gun_choice].price));
gun_stats.price = weapons_slot[gun_choice].price;
gun_stats.energy_consumption = weapons_slot[gun_choice].energy_consumption;

/*
// Get the detailsfrom the gun for the Gun Stats display
gun_stats.damage = global.ship.slot[0].damage;
gun_stats.ammo_capacity = global.ship.slot[0].ammo_capacity;
gun_stats.recharge_time = global.ship.slot[0].recharge_time;
gun_stats.fire_rate = global.ship.slot[0].fire_rate;
gun_stats.price = global.ship.slot[0].price;
gun_stats.energy_consumption = global.ship.slot[0].energy_consumption;

*/
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Manage the OWNED label object
is_owned = false;
for (i=0; i&lt;array_length_1d(global.current_player.purchased); i+=1)
{
    // for each weapon in the purchased list, set the price to 0
    if object_get_name(global.ship.slot[0].object_index) == global.current_player.purchased[i]
    {
        is_owned = true;
        show_debug_message("Gun OWNED");
    }
}

// set the label
// but not for the empty slot (dummy gun)
if is_owned == true &amp;&amp; (object_get_parent(global.ship.slot[0].object_index) != o_empty_slot)
{
    show_debug_message("Gun OWNED and is NOT EMPTY SLOT");
    if instance_exists(purchased_label)
    {
        with (purchased_label)
        {
            instance_destroy();
        }
    }
   purchased_label = instance_create(x, y, o_gun_box_purchased);
   show_debug_message("SO CREATE A LABEL");
}
else
{
    if instance_exists(purchased_label)
    {
        with (purchased_label)
        {
            instance_destroy();
        }
    }
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Set the image
image_index = gun_choice;
draw_self();
//draw_text(x,y+32,string(gun_choice));
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
